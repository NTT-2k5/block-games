<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Sequence Puzzle Game</title>
  <style>
    /* 1. RESET & COMPATIBILITY BASE */
    body {
      background-color: #f5f7fa; /* Light Background */
      color: #333333; /* Dark Text */
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      margin: 0;
      padding: 10px;
      /* Prevent text selection on touch */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-transition: background-color 0.5s;
      transition: background-color 0.5s;
    }

    h1 {
      margin: 10px 0 5px 0;
      font-size: 24px;
      color: #4a6fa5; /* Primary Blue */
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    p {
      margin: 5px 0 15px 0;
      font-size: 14px;
      color: #666;
    }

    /* 2. THE GAME BOARD */
    #game-container {
      display: inline-block;
      background: #ffffff; /* White Card */
      padding: 15px;
      border-radius: 12px;
      /* Soft Shadow */
      box-shadow: 0 10px 25px rgba(74, 111, 165, 0.15); 
    }

    table {
      border-spacing: 6px;
      border-collapse: separate;
      margin: 0 auto;
    }

    /* 3. BUTTONS (SWITCHES) */
    .btn-switch {
      width: 50px;
      height: 50px;
      border: none;
      border-radius: 8px; /* Softer corners */
      cursor: pointer;
      position: relative;
      padding: 0;
      outline: none;
      -webkit-transition: opacity 0.2s, transform 0.1s, background-color 0.2s;
      transition: opacity 0.2s, transform 0.1s, background-color 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .btn-switch:active {
      -webkit-transform: scale(0.95);
      transform: scale(0.95);
    }

    .btn-col {
      background-color: #eb8890; 
    }
    
    .btn-row {
      background-color: #92d196;
    }

    .btn-switch:disabled {
      cursor: default;
      opacity: 0.3; 
      background-color: #cfd8dc; /* Light Grey when used */
      box-shadow: none;
    }

    /* CSS Arrows */
    .arrow-down {
      width: 0; height: 0; 
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 10px solid white;
      margin: 0 auto;
    }

    .arrow-right {
      width: 0; height: 0; 
      border-top: 8px solid transparent;
      border-bottom: 8px solid transparent;
      border-left: 10px solid white;
      margin: 0 auto;
    }

    /* 4. THE LED CELL */
    .cell {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      position: relative;
      border: 2px solid #ecf0f1; /* Very light border */
      -webkit-transition: background-color 0.3s;
      transition: background-color 0.3s;
    }

    /* STATE 1: GREY (Initial) */
    .cell-grey {
      background-color: #f5f7fa; /* Light Grey */
      box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
    }

    /* STATE 2: RED (Set by Column Button) */
    .cell-red {
      background-color: #eb8890; 
      box-shadow: 0 0 10px rgba(79, 195, 247, 0.4);
      border-color: #eb8890;
    }
    
    /* STATE 3: GREEN (Set by Row Button) */
    .cell-green {
      background-color: #92d196; 
      box-shadow: 0 0 10px rgba(74, 111, 165, 0.4);
      border-color: #92d196;
    }

    /* 5. THE TARGET DOT */
    .target-dot {
      width: 18px;
      height: 18px;
      border-radius: 50%;	
      position: absolute;
      top: 50%;
      left: 50%;
      margin-top: -11px; /* Half size + border */
      margin-left: -11px;
      z-index: 2;
      border: 2px solid #f5f7fa; 
      box-shadow: 2px 2px 2px rgba(0,0,0,0.2);
    }

    /* Target is Sky */
    .target-red {
      background-color: #eb8890; /* Slightly darker for visibility on light bg */
    }
    
    /* Target is Blue */
    .target-green {
      background-color: #92d196; /* Very dark blue for contrast */
    }

    /* 6. UTILITY UI */
    .controls { margin-top: 20px; }

    .btn-main {
      background-color: #166088; /* Secondary Color */
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 15px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px;
      font-family: inherit;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      -webkit-transition: background-color 0.2s;
      transition: background-color 0.2s;
    }
    
    .btn-main:hover {
      background-color: #2c7cb0; /* Hover Color */
    }

    /* Retry Button Style */
    .btn-retry {
      background-color: #4caf50; /* Success Color */
    }
    .btn-retry:hover {
      background-color: #388e3c;
    }
    

    /* Mobile Tweaks
    @media (max-width: 480px) {
      .btn-switch, .cell { width: 38px; height: 38px; }
      table { border-spacing: 4px; }
      h1 { font-size: 20px; }
      .btn-main { padding: 8px 16px; font-size: 14px; }
    } */
  </style>
</head>
<body>

  <h1>Sequence Puzzle</h1>
  <p>Match each cell's color to its middle dot's color.<br>You must use all the arrow buttons!</p>

  <div id="game-container">
    <table id="board-table"></table>
  </div>

  <div class="controls">
    <button class="btn-main btn-retry" onclick="retrySequence()">Retry</button>
    <br>
    <button class="btn-main" onclick="initGame(3)">Easy (3x3)</button>
    <button class="btn-main" onclick="initGame(4)">Normal (4x4)</button>
    <button class="btn-main" onclick="initGame(5)">Hard (5x5)</button>
  </div>

<script>
  var size = 4;
  var gridState = [];   
  var targetState = []; 
  var switchStates = { rows: [], cols: [] };

  // CONSTANTS
  var STATE_GREY = -1;
  var STATE_RED = 0; 
  var STATE_GREEN = 1; 

  function initGame(newSize) {
    if (newSize) size = newSize;
    
    // 1. Reset
    gridState = [];
    targetState = [];
    switchStates.rows = [];
    switchStates.cols = [];
    
    // 2. Init Arrays
    for (var r = 0; r < size; r++) {
      gridState[r] = [];
      targetState[r] = [];
      switchStates.rows[r] = false; 
      for (var c = 0; c < size; c++) {
        // Cells start as GREY (-1)
        gridState[r][c] = STATE_GREY;
        targetState[r][c] = STATE_GREY; 
      }
    }
    for (var c = 0; c < size; c++) {
      switchStates.cols[c] = false;
    }

    // 3. Generate Target
    generateTarget();

    // 4. Render
    renderBoard();
    document.body.style.backgroundColor = "#f5f7fa";
  }

  function retrySequence() {
    // Keep target, reset grid and buttons
    for (var r = 0; r < size; r++) {
      switchStates.rows[r] = false; 
      for (var c = 0; c < size; c++) {
        gridState[r][c] = STATE_GREY;
      }
    }
    for (var c = 0; c < size; c++) {
      switchStates.cols[c] = false;
    }
    
    renderBoard();
    document.body.style.backgroundColor = "#f5f7fa";
  }

  function generateTarget() {
    var tempGrid = [];
    for(var r=0; r<size; r++) {
      tempGrid[r] = [];
      for(var c=0; c<size; c++) tempGrid[r][c] = STATE_GREY;
    }

    // Create moves deck
    var moves = [];
    for(var r=0; r<size; r++) moves.push({type: 'row', index: r});
    for(var c=0; c<size; c++) moves.push({type: 'col', index: c});

    // Shuffle
    for (var i = moves.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = moves[i];
      moves[i] = moves[j];
      moves[j] = temp;
    }

    // Apply moves
    for (var i = 0; i < moves.length; i++) {
      var m = moves[i];
      if (m.type === 'row') {
        // Row turns BLUE (1)
        for(var c=0; c<size; c++) tempGrid[m.index][c] = STATE_GREEN;
      } else {
        // Col turns SKY (0)
        for(var r=0; r<size; r++) tempGrid[r][m.index] = STATE_RED;
      }
    }

    targetState = tempGrid;
  }

  function renderBoard() {
    var table = document.getElementById("board-table");
    table.innerHTML = ""; 

    // --- Header Row ---
    var headerRow = table.insertRow(-1);
    var cornerCell = headerRow.insertCell(-1);
    cornerCell.style.border = "none"; 

    for (var c = 0; c < size; c++) {
      var cell = headerRow.insertCell(-1);
      var btn = document.createElement("button");
      btn.className = "btn-switch btn-col"; 
      btn.innerHTML = "<div class='arrow-down'></div>";
      
      if (switchStates.cols[c]) btn.disabled = true;

      btn.onclick = (function(colIndex) {
        return function() { handleColClick(colIndex); };
      })(c);

      cell.appendChild(btn);
    }

    // --- Grid Rows ---
    for (var r = 0; r < size; r++) {
      var tr = table.insertRow(-1);
      var btnCell = tr.insertCell(-1);
      var rBtn = document.createElement("button");
      rBtn.className = "btn-switch btn-row"; 
      rBtn.innerHTML = "<div class='arrow-right'></div>";
      
      if (switchStates.rows[r]) rBtn.disabled = true;

      rBtn.onclick = (function(rowIndex) {
        return function() { handleRowClick(rowIndex); };
      })(r);
      
      btnCell.appendChild(rBtn);

      // Cells
      for (var c = 0; c < size; c++) {
        var td = tr.insertCell(-1);
        td.className = "cell";
        
        // 1. Current State
        if (gridState[r][c] === STATE_GREEN) {
           td.className += " cell-green";
        } else if (gridState[r][c] === STATE_RED) {
           td.className += " cell-red";
        } else {
           td.className += " cell-grey";
        }

        // 2. Target Dot
        var dot = document.createElement("div");
        dot.className = "target-dot";
        if (targetState[r][c] === STATE_GREEN) {
          dot.className += " target-green";
        } else if (targetState[r][c] === STATE_RED) {
          dot.className += " target-red";
        } 
        
        td.appendChild(dot);
      }
    }
  }

  function handleRowClick(r) {
    for (var c = 0; c < size; c++) {
      gridState[r][c] = STATE_GREEN;
    }
    switchStates.rows[r] = true;
    updateGame();
  }

  function handleColClick(c) {
    for (var r = 0; r < size; r++) {
      gridState[r][c] = STATE_RED;
    }
    switchStates.cols[c] = true;
    updateGame();
  }

  function updateGame() {
    renderBoard();
    checkWin();
  }
  
  
  function checkWin() {
    var remaining = 0;
    for(var i=0; i<size; i++) {
      if(!switchStates.rows[i]) remaining++;
      if(!switchStates.cols[i]) remaining++;
    }

    if (remaining > 0) return; 
    
    var allMatch = true;
    for (var r = 0; r < size; r++) {
      for (var c = 0; c < size; c++) {
        if (gridState[r][c] !== targetState[r][c]) {
          allMatch = false;
          break;
        }
      }
    }

    if (allMatch) {
      document.body.style.backgroundColor = "#d7f7da"; // Light Green bg
    } else {
      document.body.style.backgroundColor = "#fadee3"; // Light Red bg
    }
  }

  initGame(4);
</script>
</body>

</html>
